<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Longitudinal carriage: validation of contig-cluster approach • blantyreESBL</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Longitudinal carriage: validation of contig-cluster approach">
<meta property="og:description" content="blantyreESBL">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">blantyreESBL</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/analysis-ecoli.html">Analysis scripts: E. coli genomics</a>
    </li>
    <li>
      <a href="../articles/analysis-kleb.html">Analysis scripts: K. pneumoniae complex genomics</a>
    </li>
    <li>
      <a href="../articles/analysis.html">Analysis scripts: longitudinal ESBL carriage dynamics</a>
    </li>
    <li>
      <a href="../articles/contig-clusters.html">Longitudinal carriage: validation of contig-cluster approach</a>
    </li>
    <li>
      <a href="../articles/fitting-stan-models.html">Fitting and simulating from Stan models</a>
    </li>
    <li>
      <a href="../articles/simulations.html">Longitudinal carriage: simulations to explore impact of one colony pick</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Longitudinal carriage: validation of
contig-cluster approach</h1>
            
      
      
      <div class="hidden name"><code>contig-clusters.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction-and-methods">Introduction and Methods<a class="anchor" aria-label="anchor" href="#introduction-and-methods"></a>
</h2>
<p>Reviewers of the manuscript asked for more detail on the contig
cluster analysis. This is provided below; two additional analyses are
provided. First, I explore the stability of the clusters to changing the
parameters of the clustering algorithm. The clusters were originally
defined using cd-hit with no length cutoff, and a sequence identity of
0.95 (with kmer length 10); in this sensitivity analysis, the length
cutoff (of smaller sequences relative to the largest in the cluster) was
varied from 0 to 0.8 in steps of 0.2 (with sequence identity held at
0.95), and sequence identity of the smaller sequences to the cluster
representative was varied from 0.95 to 1 in steps of 0.01.</p>
<p>The effect of these changes was assessed in two ways: first, by
plotting cumulative cluster membership: that is, ordering clusters from
largest to smallest along the x axis, and plotting the cumulative
proportion of samples that are clustered as the number of clusters
increases. Secondly, by plotting network graphs of clusters. In these
plots, points are clusters with point size determined by cluster size.
As length or sequence identifty cutoff is changed, the clusters
fragment, so the points become smaller. Points containing the same
samples are linked by lines, showing how clusters fragment. The graphs
are plotted as directed acyclic graphs: in each case, the original
clusters are at the top of the page and then the clusters with higher
length or sequence identity cutoff are sequentially below.</p>
<p>The second analysis consists of generating multiple sequence
alignments of the clusters themselves, then visualising them with the
sequence coverage of the cluster representative sample, along with
measures of sequence diversity. Multiple sequence alignments were
generated by mapping the contigs to the cluster representative sequence
with minimap2 v2.16 and the -asm5 presets. SAM files were used to
generate a multiple sequence alignment then nucleotide diversity at each
position calculated using PopGenome v2.7.5 in R.</p>
<p>Alignments were plotted from the generated PAF files with coverage of
the reference sequence indicated by colour. Secondary alignments are
shown with dashed outlines. Plots are in order of cluster size from
largest to smallest. BLAST using the ISfinder, SRST2 versuion of
ARG-ANNOT, and plasmidfinder databases were used to identify insertion
sequences, AMR genes and plasmid replicons, respectively. Genes were
filtered by bitscore to produce a single gene at any location; if
multiple genes had the same bitscore then they are labelled by group
(i.e. amr gene family or IS group) rather than being identified to gene
level.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">blantyreESBL</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://igraph.org" class="external-link">igraph</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'igraph'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     decompose, spectrum</span>
<span class="co">#&gt; The following object is masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     union</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggraph.data-imaginist.com" class="external-link">ggraph</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: ggplot2</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'tidygraph'</span>
<span class="co">#&gt; The following object is masked from 'package:igraph':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     groups</span>
<span class="co">#&gt; The following object is masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:igraph':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     as_data_frame, groups, union</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://forcats.tidyverse.org" class="external-link">forcats</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'purrr'</span>
<span class="co">#&gt; The following objects are masked from 'package:igraph':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     compose, simplify</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">PopGenome</span><span class="op">)</span>
<span class="co">#&gt; Loading required package: ff</span>
<span class="co">#&gt; Loading required package: bit</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'bit'</span>
<span class="co">#&gt; The following object is masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     xor</span>
<span class="co">#&gt; Attaching package ff</span>
<span class="co">#&gt; - getOption("fftempdir")=="/var/folders/qc/twvrz5kx0gj2lrt4n8wtk1ym0000gn/T//RtmpNmD3wC/ff"</span>
<span class="co">#&gt; - getOption("ffextension")=="ff"</span>
<span class="co">#&gt; - getOption("ffdrop")==TRUE</span>
<span class="co">#&gt; - getOption("fffinonexit")==TRUE</span>
<span class="co">#&gt; - getOption("ffpagesize")==65536</span>
<span class="co">#&gt; - getOption("ffcaching")=="mmnoflush"  -- consider "ffeachflush" if your system stalls on large writes</span>
<span class="co">#&gt; - getOption("ffbatchbytes")==16777216 -- consider a different value for tuning your system</span>
<span class="co">#&gt; - getOption("ffmaxbytes")==536870912 -- consider a different value for tuning your system</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'ff'</span>
<span class="co">#&gt; The following objects are masked from 'package:utils':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     write.csv, write.csv2</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     is.factor, is.ordered</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: viridisLite</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span>
<span class="co">#&gt; here() starts at /Users/joelewis/R/packages/blantyreESBL</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/IRanges" class="external-link">IRanges</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: BiocGenerics</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'BiocGenerics'</span>
<span class="co">#&gt; The following objects are masked from 'package:dplyr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     combine, intersect, setdiff, union</span>
<span class="co">#&gt; The following objects are masked from 'package:igraph':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     normalize, path, union</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     IQR, mad, sd, var, xtabs</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     anyDuplicated, append, as.data.frame, basename, cbind, colnames,</span>
<span class="co">#&gt;     dirname, do.call, duplicated, eval, evalq, Filter, Find, get, grep,</span>
<span class="co">#&gt;     grepl, intersect, is.unsorted, lapply, Map, mapply, match, mget,</span>
<span class="co">#&gt;     order, paste, pmax, pmax.int, pmin, pmin.int, Position, rank,</span>
<span class="co">#&gt;     rbind, Reduce, rownames, sapply, setdiff, sort, table, tapply,</span>
<span class="co">#&gt;     union, unique, unsplit, which.max, which.min</span>
<span class="co">#&gt; Loading required package: S4Vectors</span>
<span class="co">#&gt; Loading required package: stats4</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'S4Vectors'</span>
<span class="co">#&gt; The following objects are masked from 'package:dplyr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     first, rename</span>
<span class="co">#&gt; The following objects are masked from 'package:tidygraph':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     active, rename</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     expand.grid, I, unname</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'IRanges'</span>
<span class="co">#&gt; The following object is masked from 'package:purrr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     reduce</span>
<span class="co">#&gt; The following objects are masked from 'package:dplyr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     collapse, desc, slice</span>
<span class="co">#&gt; The following object is masked from 'package:tidygraph':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     slice</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ggnewscale</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/slowkow/ggrepel" class="external-link">ggrepel</a></span><span class="op">)</span>

<span class="va">write_figs</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>


<span class="kw">if</span> <span class="op">(</span><span class="va">write_figs</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"figures"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"figures"</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"tables"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"tables"</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>
  
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"figures/long-modelling"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"figures/long-modelling"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"tables/long-modelling"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"tables/long-modelling"</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span>
<span class="op">}</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h2>
<div class="section level3">
<h3 id="varying-length-and-sequence-identity-cutoff-in-clsutering-algorithm">Varying length and sequence identity cutoff in clsutering
algorithm<a class="anchor" aria-label="anchor" href="#varying-length-and-sequence-identity-cutoff-in-clsutering-algorithm"></a>
</h3>
<div class="section level4">
<h4 id="cumulative-cluster-membership-plots">Cumulative cluster membership plots<a class="anchor" aria-label="anchor" href="#cumulative-cluster-membership-plots"></a>
</h4>
<p>Clusters are stable to increasing length cutoff, and increasing
sequence identity - up to 100%, when the clusters fragment.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># function to restrict axes to integers</span>
<span class="va">int_breaks_rounded</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>  <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/pretty.html" class="external-link">pretty</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">n</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/pretty.html" class="external-link">pretty</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">n</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">1</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span>
<span class="op">}</span>

<span class="co"># cluster cumulative membership: varying length cutoff ----------------</span>

<span class="va">btESBL_contigclusters_sensax</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ident_cutoff</span> <span class="op">==</span> <span class="fl">0.95</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">transmute</a></span><span class="op">(</span>
    id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"^\\."</span>, <span class="st">""</span>, <span class="va">contig</span><span class="op">)</span>,
    clstr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span>,
    gene <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">""</span>, <span class="va">gene</span><span class="op">)</span>,
    len_diff_cutoff <span class="op">=</span> <span class="va">len_diff_cutoff</span>,
    ident_cutoff <span class="op">=</span> <span class="va">ident_cutoff</span>
  <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>clstr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>
    <span class="va">clstr</span>,
    <span class="st">"_"</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">""</span>, <span class="va">gene</span><span class="op">)</span>,
    <span class="st">"_l"</span>,
    <span class="va">len_diff_cutoff</span>,
    <span class="st">"_i"</span>,
    <span class="va">ident_cutoff</span>
  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span>
    <span class="va">btESBL_contigclusters</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">transmute</a></span><span class="op">(</span>
        id <span class="op">=</span> <span class="va">id</span>,
        gene <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">""</span>, <span class="va">gene</span><span class="op">)</span>,
        len_diff_cutoff <span class="op">=</span> <span class="fl">0</span>,
        ident_cutoff <span class="op">=</span> <span class="fl">0.95</span>,
        clstr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>
          <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">clstr_name</span>, <span class="st">"(?&lt;=\\.)[0-9]*$"</span><span class="op">)</span>,
          <span class="st">"_"</span>,
          <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">clstr_name</span>, <span class="st">".*(?=\\.)"</span><span class="op">)</span>,
          <span class="st">"_l"</span>,
          <span class="va">len_diff_cutoff</span>,
          <span class="st">"_i"</span>,
          <span class="va">ident_cutoff</span>
        <span class="op">)</span>
      <span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">len_diff_cutoff</span>, <span class="va">gene</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    n_gene <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">gene</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    gene <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">gene</span>, <span class="st">" (n = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">n_gene</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    gene <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html" class="external-link">fct_rev</a></span><span class="op">(</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html" class="external-link">fct_reorder</a></span><span class="op">(</span><span class="va">gene</span>, <span class="va">n_gene</span>, .fun <span class="op">=</span> <span class="va">max</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">len_diff_cutoff</span>, <span class="va">clstr</span>, <span class="va">gene</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">gene</span>, <span class="va">len_diff_cutoff</span>, <span class="op">-</span><span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">gene</span>, <span class="va">len_diff_cutoff</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>n_clust <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    prop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="co"># addd skanky (0,0) start</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">gene</span>, <span class="va">len_diff_cutoff</span>, <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">gene</span>, <span class="va">len_diff_cutoff</span>, <span class="va">n_clust</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/do.html" class="external-link">do</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html" class="external-link">add_row</a></span><span class="op">(</span><span class="va">.</span>, .before <span class="op">=</span> <span class="fl">1</span>, prop <span class="op">=</span> <span class="fl">0</span>, n_clust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/do.html" class="external-link">do</a></span><span class="op">(</span><span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/fill.html" class="external-link">fill</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="va">len_diff_cutoff</span>, <span class="va">gene</span><span class="op">)</span>, .direction <span class="op">=</span> <span class="st">"up"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">n_clust</span>,
    <span class="va">prop</span>,
    group <span class="op">=</span> <span class="va">len_diff_cutoff</span>,
    color <span class="op">=</span> <span class="va">len_diff_cutoff</span>
  <span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">gene</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"Number of clusters"</span>,
    y <span class="op">=</span> <span class="st">"Cumulative number of samples"</span>,
    color <span class="op">=</span> <span class="st">"CD-HIT\nlength cutoff"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">int_breaks_rounded</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">len_plot</span>

<span class="va">len_plot</span></code></pre></div>
<div class="figure">
<img src="contig-clusters_files/figure-html/plot-cum-membership-1.png" alt="Cumulative proportion of samples that are included in a cluster as a function of number of clusters, stratified by ESBL gene. CLusters are ordered on the x-axis from smallest to largest. Number of samples in which a given ESBL geen was found is shown in the panel header. The coloured lines show the effect of varying the sequence length cutoff in the clustering algorithm." width="864"><p class="caption">
Cumulative proportion of samples that are included in a cluster as a
function of number of clusters, stratified by ESBL gene. CLusters are
ordered on the x-axis from smallest to largest. Number of samples in
which a given ESBL geen was found is shown in the panel header. The
coloured lines show the effect of varying the sequence length cutoff in
the clustering algorithm.
</p>
</div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="kw">if</span> <span class="op">(</span><span class="va">write_figs</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"figures/long-modelling/SUP_FIG_contig_sensax_lenplot.pdf"</span><span class="op">)</span>,
         <span class="va">len_plot</span>,width <span class="op">=</span> <span class="fl">9</span>, height <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"figures/long-modelling/SUP_FIG_contig_sensax_lenplot.svg"</span><span class="op">)</span>,
         <span class="va">len_plot</span>,width <span class="op">=</span> <span class="fl">9</span>, height <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">

<span class="va">btESBL_contigclusters_sensax</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">len_diff_cutoff</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">transmute</a></span><span class="op">(</span>
    id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"^\\."</span>, <span class="st">""</span>, <span class="va">contig</span><span class="op">)</span>,
    clstr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span>,
    gene <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">""</span>, <span class="va">gene</span><span class="op">)</span>,
    len_diff_cutoff <span class="op">=</span> <span class="va">len_diff_cutoff</span>,
    ident_cutoff <span class="op">=</span> <span class="va">ident_cutoff</span>
  <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>clstr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>
    <span class="va">clstr</span>,
    <span class="st">"_"</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">""</span>, <span class="va">gene</span><span class="op">)</span>,
    <span class="st">"_l"</span>,
    <span class="va">len_diff_cutoff</span>,
    <span class="st">"_i"</span>,
    <span class="va">ident_cutoff</span>
  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span>
    <span class="va">btESBL_contigclusters</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">transmute</a></span><span class="op">(</span>
        id <span class="op">=</span> <span class="va">id</span>,
        gene <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">""</span>, <span class="va">gene</span><span class="op">)</span>,
        len_diff_cutoff <span class="op">=</span> <span class="fl">0</span>,
        ident_cutoff <span class="op">=</span> <span class="fl">0.95</span>,
        clstr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>
          <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">clstr_name</span>, <span class="st">"(?&lt;=\\.)[0-9]*$"</span><span class="op">)</span>,
          <span class="st">"_"</span>,
          <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">clstr_name</span>, <span class="st">".*(?=\\.)"</span><span class="op">)</span>,
          <span class="st">"_l"</span>,
          <span class="va">len_diff_cutoff</span>,
          <span class="st">"_i"</span>,
          <span class="va">ident_cutoff</span>
        <span class="op">)</span>
      <span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ident_cutoff</span>, <span class="va">gene</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    n_gene <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">gene</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    gene <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">gene</span>, <span class="st">" (n = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">n_gene</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    gene <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_inorder.html" class="external-link">fct_infreq</a></span><span class="op">(</span><span class="va">gene</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ident_cutoff</span>, <span class="va">clstr</span>, <span class="va">gene</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">gene</span>, <span class="va">ident_cutoff</span>, <span class="op">-</span><span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">gene</span>, <span class="va">ident_cutoff</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>n_clust <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    prop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="co"># addd skanky (0,0) start</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">gene</span>, <span class="va">ident_cutoff</span>, <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">gene</span>, <span class="va">ident_cutoff</span>, <span class="va">n_clust</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/do.html" class="external-link">do</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html" class="external-link">add_row</a></span><span class="op">(</span><span class="va">.</span>, .before <span class="op">=</span> <span class="fl">1</span>, prop <span class="op">=</span> <span class="fl">0</span>, n_clust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/do.html" class="external-link">do</a></span><span class="op">(</span><span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/fill.html" class="external-link">fill</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ident_cutoff</span>, <span class="va">gene</span><span class="op">)</span>, .direction <span class="op">=</span> <span class="st">"up"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">n_clust</span>,
    <span class="va">prop</span>,
    group <span class="op">=</span> <span class="va">ident_cutoff</span>,
    color <span class="op">=</span> <span class="va">ident_cutoff</span>
  <span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">gene</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"Number of clusters"</span>,
    y <span class="op">=</span> <span class="st">"Cumulative number of samples"</span>,
    color <span class="op">=</span> <span class="st">"CD-HIT\nidentity cutoff"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">int_breaks_rounded</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">ident_plot</span>

<span class="va">ident_plot</span></code></pre></div>
<div class="figure">
<img src="contig-clusters_files/figure-html/plot-cum-membership2-1.png" alt="Cumulative proportion of samples that are included in a cluster as a function of number of clusters, stratified by ESBL gene. CLusters are ordered on the x-axis from smallest to largest. Number of samples in which a given ESBL geen was found is shown in the panel header. The coloured lines show the effect of varying the sequence identity cutoff in the clustering algorithm." width="864"><p class="caption">
Cumulative proportion of samples that are included in a cluster as a
function of number of clusters, stratified by ESBL gene. CLusters are
ordered on the x-axis from smallest to largest. Number of samples in
which a given ESBL geen was found is shown in the panel header. The
coloured lines show the effect of varying the sequence identity cutoff
in the clustering algorithm.
</p>
</div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="kw">if</span> <span class="op">(</span><span class="va">write_figs</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"figures/long-modelling/SUP_FIG_contig_sensax_identplot.pdf"</span><span class="op">)</span>,
         <span class="va">ident_plot</span>,width <span class="op">=</span> <span class="fl">9</span>, height <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"figures/long-modelling/SUP_FIG_contig_sensax_identplot.svg"</span><span class="op">)</span>,
         <span class="va">ident_plot</span>,width <span class="op">=</span> <span class="fl">9</span>, height <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="directed-acyclic-graphs-of-cluster-membership">Directed acyclic graphs of cluster membership<a class="anchor" aria-label="anchor" href="#directed-acyclic-graphs-of-cluster-membership"></a>
</h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># plotting functions ----------------------</span>
<span class="va">return_cluster_plot_df</span> <span class="op">&lt;-</span>
  <span class="kw">function</span><span class="op">(</span><span class="va">sample_cluster_df</span>, <span class="va">gene_to_plot</span>, <span class="va">cluster_cutoff</span>,
           <span class="va">len_cutoff_vec</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span><span class="op">)</span>,
           <span class="va">ident_cutoff_vec</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="fl">0.95</span>, <span class="fl">0.95</span>, <span class="fl">0.95</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">len_cutoff_vec</span><span class="op">)</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ident_cutoff_vec</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
      <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Different vector lengths in return_cluster_plot_df"</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">len_cutoff_vec</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span>
      <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Need at least 2 len_ and ident_ cutoff values"</span><span class="op">)</span>
    <span class="op">}</span>

    <span class="co"># assume a data frame with</span>
    <span class="co"># id = cntig id</span>
    <span class="co"># clstre = cluster id</span>
    <span class="co"># gene = gene</span>
    <span class="co"># len_dfiff_cutoff</span>
    <span class="co"># idnet_cutoff</span>
    <span class="co"># l</span>
    <span class="co"># This will plot 5 layers - a is top, defined by the len and ident_cutoffs</span>
    <span class="co"># provided; b next, -&gt; c , etc</span>
    <span class="co"># clsuter_cutoff will plot only clusters in row a of size &gt;= cluster cutoff</span>
    <span class="co"># the len_cut</span>
    <span class="co"># the strategy:</span>
    <span class="co"># 1) make a df of each unique set of len and  ident_cutoffs</span>
    <span class="co"># 2) left join df a to df b by sample id - the clusters in dfa become</span>
    <span class="co"># clst.x and the clsuters in dfb become clst.y.</span>
    <span class="co"># 3) group by clust.x and xlust y and tally</span>
    <span class="co"># 4) Add in other dfs in same way</span>

    <span class="va">dfa</span> <span class="op">&lt;-</span>
      <span class="va">sample_cluster_df</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span>
        <span class="va">gene</span> <span class="op">==</span> <span class="va">gene_to_plot</span>,
        <span class="va">len_diff_cutoff</span> <span class="op">==</span> <span class="va">len_cutoff_vec</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
        <span class="va">ident_cutoff</span> <span class="op">==</span> <span class="va">ident_cutoff_vec</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
      <span class="op">)</span>

    <span class="va">dfb</span> <span class="op">&lt;-</span> <span class="va">sample_cluster_df</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span>
        <span class="va">gene</span> <span class="op">==</span> <span class="va">gene_to_plot</span>,
        <span class="va">len_diff_cutoff</span> <span class="op">==</span> <span class="va">len_cutoff_vec</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,
        <span class="va">ident_cutoff</span> <span class="op">==</span> <span class="va">ident_cutoff_vec</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>
      <span class="op">)</span>

    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span>
      <span class="va">dfa</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">clstr</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">clstr</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>clst.size <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">clst.size</span> <span class="op">&gt;=</span> <span class="va">cluster_cutoff</span><span class="op">)</span>,
      <span class="va">dfb</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">clstr</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">clstr</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>clst.size <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,
      by <span class="op">=</span> <span class="st">"id"</span>
    <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">clstr.x</span>, <span class="va">clst.size.x</span>, <span class="va">clstr.y</span>, <span class="va">clst.size.y</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">tally</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">transmute</a></span><span class="op">(</span>
        from_clst_size <span class="op">=</span> <span class="va">clst.size.x</span>,
        from <span class="op">=</span> <span class="va">clstr.x</span>,
        to_clst_size <span class="op">=</span> <span class="va">clst.size.y</span>,
        to <span class="op">=</span> <span class="va">clstr.y</span>,
        n <span class="op">=</span> <span class="va">n</span>
      <span class="op">)</span> <span class="op">-&gt;</span>
    <span class="va">edges</span>

    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span>
      <span class="va">dfa</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">clstr</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span> <span class="va">edges</span><span class="op">$</span><span class="va">from</span><span class="op">)</span>,
      <span class="va">dfb</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">clstr</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span> <span class="va">edges</span><span class="op">$</span><span class="va">to</span><span class="op">)</span>
    <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span>
        <span class="va">clstr</span>, <span class="va">len_diff_cutoff</span>,
        <span class="va">ident_cutoff</span>
      <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">nodes</span>

    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">len_cutoff_vec</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span>
      <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">3</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">len_cutoff_vec</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">sample_cluster_df</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
          <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span>
            <span class="va">len_diff_cutoff</span> <span class="op">==</span> <span class="va">len_cutoff_vec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,
            <span class="va">ident_cutoff</span> <span class="op">==</span> <span class="va">ident_cutoff_vec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,
            <span class="va">gene</span> <span class="op">==</span> <span class="va">gene_to_plot</span>
          <span class="op">)</span> <span class="op">-&gt;</span> <span class="va">dfc</span>
        <span class="fu">add_next_edge_layer</span><span class="op">(</span><span class="va">edges</span>, <span class="va">dfb</span>, <span class="va">dfc</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">newedges</span>
        <span class="fu">add_new_nodes</span><span class="op">(</span><span class="va">newedges</span>, <span class="va">dfc</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">newnodes</span>
        <span class="va">nodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">nodes</span>, <span class="va">newnodes</span><span class="op">)</span>
        <span class="va">edges</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">edges</span>, <span class="va">newedges</span><span class="op">)</span>
        <span class="va">dfb</span> <span class="op">&lt;-</span> <span class="va">dfc</span>
      <span class="op">}</span>
    <span class="op">}</span>

    <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/tbl_graph.html" class="external-link">tbl_graph</a></span><span class="op">(</span>
      nodes <span class="op">=</span> <span class="va">nodes</span>,
      edges <span class="op">=</span> <span class="va">edges</span>,
      directed <span class="op">=</span> <span class="cn">TRUE</span>
    <span class="op">)</span> <span class="op">-&gt;</span> <span class="va">out_graph_df</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out_graph_df</span><span class="op">)</span>
  <span class="op">}</span>

<span class="va">add_next_edge_layer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">edges</span>, <span class="va">dfb</span>, <span class="va">dfc</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span>
    <span class="va">dfb</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">clstr</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span> <span class="va">edges</span><span class="op">$</span><span class="va">to</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">clstr</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">clstr</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>clst.size <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,
    <span class="va">dfc</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">clstr</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">clstr</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>clst.size <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,
    by <span class="op">=</span> <span class="st">"id"</span>
  <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">clstr.x</span>, <span class="va">clst.size.x</span>, <span class="va">clstr.y</span>, <span class="va">clst.size.y</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">tally</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">transmute</a></span><span class="op">(</span>
      from_clst_size <span class="op">=</span> <span class="va">clst.size.x</span>,
      from <span class="op">=</span> <span class="va">clstr.x</span>,
      to_clst_size <span class="op">=</span> <span class="va">clst.size.y</span>,
      to <span class="op">=</span> <span class="va">clstr.y</span>,
      n <span class="op">=</span> <span class="va">n</span>
    <span class="op">)</span> <span class="op">-&gt;</span>
  <span class="va">edges_new</span>

  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">edges_new</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">add_new_nodes</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">edges</span>, <span class="va">dfc</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">dfc</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">clstr</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span> <span class="va">edges</span><span class="op">$</span><span class="va">to</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">clstr</span>, <span class="va">len_diff_cutoff</span>, <span class="va">ident_cutoff</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">nodes_new</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">nodes_new</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">min_cluster_size_picker</span> <span class="op">&lt;-</span>  <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">gene</span> , <span class="va">cutoff</span> <span class="op">=</span> <span class="fl">20</span>, <span class="va">size</span> <span class="op">=</span> <span class="fl">5</span>, <span class="va">len</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">seq</span> <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span> <span class="op">{</span>
 <span class="va">df</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>  
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">gene</span> <span class="op">==</span> <span class="op">{</span><span class="op">{</span><span class="va">gene</span><span class="op">}</span><span class="op">}</span>,
           <span class="va">len_diff_cutoff</span> <span class="op">==</span> <span class="va">len</span>,
           <span class="va">ident_cutoff</span> <span class="op">==</span> <span class="va">seq</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">df</span>
 
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">clstr</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">cutoff</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">returnval</span> <span class="op">&lt;-</span> <span class="va">size</span>
    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
      <span class="va">returnval</span> <span class="op">&lt;-</span> <span class="fl">1</span>
  <span class="op">}</span>
  
  
<span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">returnval</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">### prepare data -----------------------------------------</span>

<span class="va">btESBL_contigclusters_sensax</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">transmute</a></span><span class="op">(</span>
    id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"^\\."</span>, <span class="st">""</span>, <span class="va">contig</span><span class="op">)</span>,
    clstr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span>,
    gene <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">""</span>, <span class="va">gene</span><span class="op">)</span>,
    len_diff_cutoff <span class="op">=</span> <span class="va">len_diff_cutoff</span>,
    ident_cutoff <span class="op">=</span> <span class="va">ident_cutoff</span>
  <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>clstr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>
    <span class="va">clstr</span>,
    <span class="st">"_"</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">""</span>, <span class="va">gene</span><span class="op">)</span>,
    <span class="st">"_l"</span>,
    <span class="va">len_diff_cutoff</span>,
    <span class="st">"_i"</span>,
    <span class="va">ident_cutoff</span>
  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span>
    <span class="va">btESBL_contigclusters</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">transmute</a></span><span class="op">(</span>
        id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"^\\."</span>, <span class="st">""</span>, <span class="va">id</span><span class="op">)</span>,
        gene <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">""</span>, <span class="va">gene</span><span class="op">)</span>,
        len_diff_cutoff <span class="op">=</span> <span class="fl">0</span>,
        ident_cutoff <span class="op">=</span> <span class="fl">0.95</span>,
        clstr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>
          <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">clstr_name</span>, <span class="st">"(?&lt;=\\.)[0-9]*$"</span><span class="op">)</span>,
          <span class="st">"_"</span>,
          <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">clstr_name</span>, <span class="st">".*(?=\\.)"</span><span class="op">)</span>,
          <span class="st">"_l"</span>,
          <span class="va">len_diff_cutoff</span>,
          <span class="st">"_i"</span>,
          <span class="va">ident_cutoff</span>
        <span class="op">)</span>
      <span class="op">)</span>
  <span class="op">)</span> <span class="op">-&gt;</span> <span class="va">sample_cluster_df</span>


<span class="va">genes</span> <span class="op">&lt;-</span> <span class="va">sample_cluster_df</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">gene</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">tally</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">gene</span><span class="op">)</span>

<span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">genes</span>,
    <span class="op">~</span> <span class="fu">return_cluster_plot_df</span><span class="op">(</span>
      <span class="va">sample_cluster_df</span>, <span class="va">.x</span>, 
      <span class="fu">min_cluster_size_picker</span><span class="op">(</span><span class="va">sample_cluster_df</span>,<span class="va">.x</span>,<span class="fl">20</span>,<span class="fl">5</span><span class="op">)</span>,
      len_cutoff_vec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,
      ident_cutoff_vec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="fl">0.97</span>, <span class="fl">0.98</span>, <span class="fl">0.99</span>, <span class="fl">1.00</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span> 
      <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span>layout <span class="op">=</span> <span class="st">"sugiyama"</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_link.html" class="external-link">geom_edge_link</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>edge_width <span class="op">=</span> <span class="va">n</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.7</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_point.html" class="external-link">geom_node_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">size</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">ident_cutoff</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"CD-HIT\nsequence\nidentity"</span>, 
        size <span class="op">=</span> <span class="st">"Cluster\nsize"</span>,
        title <span class="op">=</span> <span class="va">.x</span>,
        subtitle <span class="op">=</span> 
          <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span>
            <span class="fu">min_cluster_size_picker</span><span class="op">(</span><span class="va">sample_cluster_df</span>,<span class="va">.x</span>,<span class="fl">20</span>,<span class="fl">5</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span>,
            <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Restricted to clusters of at least "</span>, 
              <span class="fu">min_cluster_size_picker</span><span class="op">(</span><span class="va">sample_cluster_df</span>,<span class="va">.x</span>,<span class="fl">20</span>,<span class="fl">5</span><span class="op">)</span>, 
              <span class="st">" samples"</span><span class="op">)</span>,
            <span class="st">"All clusters shown"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> 
<span class="op">)</span> <span class="op">-&gt;</span> <span class="va">seq_ident_dag_plots</span>

<span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">genes</span>,
    <span class="op">~</span> <span class="fu">return_cluster_plot_df</span><span class="op">(</span>
      <span class="va">sample_cluster_df</span>, <span class="va">.x</span>, 
      <span class="fu">min_cluster_size_picker</span><span class="op">(</span><span class="va">sample_cluster_df</span>,<span class="va">.x</span>,<span class="fl">20</span>,<span class="fl">5</span><span class="op">)</span>,
      len_cutoff_vec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.2</span>,<span class="fl">0.4</span>,<span class="fl">0.6</span>,<span class="fl">0.8</span><span class="op">)</span>,
      ident_cutoff_vec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="fl">0.95</span>, <span class="fl">0.95</span>, <span class="fl">0.95</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span> 
      <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span>layout <span class="op">=</span> <span class="st">"sugiyama"</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_link.html" class="external-link">geom_edge_link</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>edge_width <span class="op">=</span> <span class="va">n</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.7</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_point.html" class="external-link">geom_node_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">size</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">len_diff_cutoff</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"CD-HIT\nlength\ncutoff"</span>, 
        size <span class="op">=</span> <span class="st">"Cluster\nsize"</span>,
         subtitle <span class="op">=</span> 
          <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span>
            <span class="fu">min_cluster_size_picker</span><span class="op">(</span><span class="va">sample_cluster_df</span>,<span class="va">.x</span>,<span class="fl">20</span>,<span class="fl">5</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span>,
            <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Restricted to clusters of at least "</span>, 
              <span class="fu">min_cluster_size_picker</span><span class="op">(</span><span class="va">sample_cluster_df</span>,<span class="va">.x</span>,<span class="fl">20</span>,<span class="fl">5</span><span class="op">)</span>, 
              <span class="st">" samples"</span><span class="op">)</span>,
            <span class="st">"All clusters shown"</span><span class="op">)</span>,
        title <span class="op">=</span> <span class="va">.x</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> 
<span class="op">)</span> <span class="op">-&gt;</span> <span class="va">len_cutoff_dag_plots</span></code></pre></div>
<div class="section level5">
<h5 id="varying-sequence-identity">Varying sequence identity<a class="anchor" aria-label="anchor" href="#varying-sequence-identity"></a>
</h5>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">seq_ident_dag_plots</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
 
   <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">seq_ident_dag_plots</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>

  <span class="kw">if</span> <span class="op">(</span><span class="va">write_figs</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>
        <span class="st">"figures/long-modelling/SUP_FIG_contig_seqidentdag_"</span>,
        <span class="va">seq_ident_dag_plots</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">title</span>,
        <span class="st">".pdf"</span>
      <span class="op">)</span><span class="op">)</span>, <span class="va">seq_ident_dag_plots</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,
      width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">4</span>
    <span class="op">)</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>
        <span class="st">"figures/long-modelling/SUP_FIG_contig_seqidentdag_"</span>,
        <span class="va">seq_ident_dag_plots</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">title</span>,
        <span class="st">".svg"</span>
      <span class="op">)</span><span class="op">)</span>, <span class="va">seq_ident_dag_plots</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,
      width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">4</span>
    <span class="op">)</span>
  <span class="op">}</span>
  
<span class="op">}</span></code></pre></div>
<p><img src="contig-clusters_files/figure-html/plot-seq-ident-1.png" width="576"><img src="contig-clusters_files/figure-html/plot-seq-ident-2.png" width="576"><img src="contig-clusters_files/figure-html/plot-seq-ident-3.png" width="576"><img src="contig-clusters_files/figure-html/plot-seq-ident-4.png" width="576"><img src="contig-clusters_files/figure-html/plot-seq-ident-5.png" width="576"><img src="contig-clusters_files/figure-html/plot-seq-ident-6.png" width="576"><img src="contig-clusters_files/figure-html/plot-seq-ident-7.png" width="576"><img src="contig-clusters_files/figure-html/plot-seq-ident-8.png" width="576"><img src="contig-clusters_files/figure-html/plot-seq-ident-9.png" width="576"><img src="contig-clusters_files/figure-html/plot-seq-ident-10.png" width="576"><img src="contig-clusters_files/figure-html/plot-seq-ident-11.png" width="576"><img src="contig-clusters_files/figure-html/plot-seq-ident-12.png" width="576"><img src="contig-clusters_files/figure-html/plot-seq-ident-13.png" width="576"><img src="contig-clusters_files/figure-html/plot-seq-ident-14.png" width="576"><img src="contig-clusters_files/figure-html/plot-seq-ident-15.png" width="576"><img src="contig-clusters_files/figure-html/plot-seq-ident-16.png" width="576"><img src="contig-clusters_files/figure-html/plot-seq-ident-17.png" width="576"><img src="contig-clusters_files/figure-html/plot-seq-ident-18.png" width="576"></p>
</div>
<div class="section level5">
<h5 id="varying-length-cutoff">Varying length cutoff<a class="anchor" aria-label="anchor" href="#varying-length-cutoff"></a>
</h5>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">len_cutoff_dag_plots</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">len_cutoff_dag_plots</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  
    <span class="kw">if</span> <span class="op">(</span><span class="va">write_figs</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>
        <span class="st">"figures/long-modelling/SUP_FIG_contig_lendag_"</span>,
        <span class="va">len_cutoff_dag_plots</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">title</span>,
        <span class="st">".pdf"</span>
      <span class="op">)</span><span class="op">)</span>, <span class="va">len_cutoff_dag_plots</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,
      width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">4</span>
    <span class="op">)</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>
        <span class="st">"figures/long-modelling/SUP_FIG_contig_lendag_"</span>,
        <span class="va">seq_ident_dag_plots</span><span class="op">[[</span><span class="fl">9</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">title</span>,
        <span class="st">".svg"</span>
      <span class="op">)</span><span class="op">)</span>, <span class="va">seq_ident_dag_plots</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,
      width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">4</span>
    <span class="op">)</span>
  <span class="op">}</span>
        <span class="op">}</span></code></pre></div>
<p><img src="contig-clusters_files/figure-html/plot-len-cutoff-1.png" width="576"><img src="contig-clusters_files/figure-html/plot-len-cutoff-2.png" width="576"><img src="contig-clusters_files/figure-html/plot-len-cutoff-3.png" width="576"><img src="contig-clusters_files/figure-html/plot-len-cutoff-4.png" width="576"><img src="contig-clusters_files/figure-html/plot-len-cutoff-5.png" width="576"><img src="contig-clusters_files/figure-html/plot-len-cutoff-6.png" width="576"><img src="contig-clusters_files/figure-html/plot-len-cutoff-7.png" width="576"><img src="contig-clusters_files/figure-html/plot-len-cutoff-8.png" width="576"><img src="contig-clusters_files/figure-html/plot-len-cutoff-9.png" width="576"><img src="contig-clusters_files/figure-html/plot-len-cutoff-10.png" width="576"><img src="contig-clusters_files/figure-html/plot-len-cutoff-11.png" width="576"><img src="contig-clusters_files/figure-html/plot-len-cutoff-12.png" width="576"><img src="contig-clusters_files/figure-html/plot-len-cutoff-13.png" width="576"><img src="contig-clusters_files/figure-html/plot-len-cutoff-14.png" width="576"><img src="contig-clusters_files/figure-html/plot-len-cutoff-15.png" width="576"><img src="contig-clusters_files/figure-html/plot-len-cutoff-16.png" width="576"><img src="contig-clusters_files/figure-html/plot-len-cutoff-17.png" width="576"><img src="contig-clusters_files/figure-html/plot-len-cutoff-18.png" width="576"></p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="multiple-sequence-alignments">Multiple sequence alignments<a class="anchor" aria-label="anchor" href="#multiple-sequence-alignments"></a>
</h3>
<p>Plots are shown for top 10 largest clusters which contain 248/714
ESBl containing contigs. Asterisk on gene name indicates identification
of gene to group only.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># The blast output contains lots of genes which overlap</span>
<span class="co"># need to pick one for each position</span>

<span class="co"># functions for cleaning up blast output for plotting -----------------</span>

<span class="co"># this will merge all overlapping matches</span>
<span class="co"># then label them with range_group id using IRanges</span>
<span class="va">add_range_group_ids</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">qstart</span>, <span class="va">qend</span>, <span class="va">sseqid</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">ir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/IRanges-constructor.html" class="external-link">IRanges</a></span><span class="op">(</span><span class="va">qstart</span>, <span class="va">qend</span>, names <span class="op">=</span> <span class="va">sseqid</span><span class="op">)</span>
  <span class="va">range_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Hits-class.html" class="external-link">subjectHits</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/findOverlaps-methods.html" class="external-link">findOverlaps</a></span><span class="op">(</span><span class="va">ir</span>, <span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html" class="external-link">reduce</a></span><span class="op">(</span><span class="va">ir</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">range_group</span><span class="op">)</span>
<span class="op">}</span>


<span class="co"># This should be passed each range_group df</span>
<span class="co"># if only one top bitscore</span>
<span class="co"># select that_</span>
<span class="co"># if ties - selct sseqid_group if they are all one group</span>
<span class="co"># if they are different groups, give a warning</span>

<span class="va">pick_best_fitting_gene</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># restrict only to top fittinmg bitscoire</span>
  <span class="va">df</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">bitscore</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">bitscore</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">df</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># if only one - set gene to sseqid gene</span>
    <span class="va">df</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
        gene <span class="op">=</span> <span class="va">sseqid_gene</span>,
        duplicate_flag <span class="op">=</span> <span class="fl">0</span>
      <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sseqid_group</span>, <span class="va">sseqid_gene</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">df</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    <span class="co"># if more than one top bitscore</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">sseqid_group</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
      <span class="co"># if they are all same group, use group</span>
      <span class="va">df</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">pident</span><span class="op">)</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">length</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
          gene <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">sseqid_group</span>, <span class="st">"*"</span><span class="op">)</span>,
          duplicate_flag <span class="op">=</span> <span class="fl">0</span>
        <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sseqid_group</span>, <span class="va">sseqid_gene</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">df</span>
    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
      <span class="va">df</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">sseqid_group</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">sseqid_group</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">pident</span><span class="op">)</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">length</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
          gene <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">sseqid_group</span>, <span class="st">"*"</span><span class="op">)</span>,
          duplicate_flag <span class="op">=</span> <span class="fl">1</span>
        <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sseqid_group</span>, <span class="va">sseqid_gene</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">df</span>
      <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span>
        <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>
          <span class="st">"Watch out! qseqid: "</span>, <span class="va">df</span><span class="op">$</span><span class="va">qseqid</span>, <span class="st">" range_group: "</span>,
          <span class="va">df</span><span class="op">$</span><span class="va">range_group</span>, <span class="st">" have multiple genes in one location.\n"</span>
        <span class="op">)</span>
      <span class="op">)</span>
    <span class="op">}</span>
  <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># tidy up and plot -----------------------------------</span>

<span class="va">btESBL_contigclusters_msa_blastoutput</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    sseqid_gene <span class="op">=</span> 
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"plasmid"</span>,
              <span class="va">sseqid_group</span>,
              <span class="va">sseqid_gene</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">qseqid</span>, <span class="va">type</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    range_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>
      <span class="va">type</span>,
      <span class="fu">add_range_group_ids</span><span class="op">(</span><span class="va">qstart</span>, <span class="va">qend</span>, <span class="va">sseqid</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">qseqid</span>, <span class="va">range_group</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sseqid</span> <span class="op">!=</span> <span class="st">"ISEc9_IS1380_unknown"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/do.html" class="external-link">do</a></span><span class="op">(</span><span class="fu">pick_best_fitting_gene</span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span>
<span class="va">blast_processed</span>

<span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span>
  <span class="va">blast_processed</span>,
  <span class="va">btESBL_contigclusters</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">clstr_name</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span>,
  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"qseqid"</span> <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">blast_processed</span>

    </code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R">


<span class="co"># This function takes</span>
<span class="co">#</span>
<span class="co"># 1) A tibble with alignment in paf format</span>
<span class="co"># 2) A multiple sequence alignment fasta in GENOME format from</span>
<span class="co">#    PopGenome</span>
<span class="co"># 3) The BLAST dataframe of IS, amr, and plasmid replicons</span>
<span class="co">#</span>
<span class="co"># And returns a ggplot with nucleotide diversity and the</span>
<span class="co"># queries shown mapped to target with colours indicating coverage</span>
<span class="co"># and the IS, AMR and plasmid replicon gebes mapped to </span>
<span class="co">#</span>
<span class="co"># The paf tibble should have colnames as per pafR package</span>
<span class="co">#     c("qname","qlen","qstart","qend","strand","tname", "tlen", "tstart",</span>
<span class="co">#      "tend","nmatch","alen","mapq")</span>
<span class="co"># See</span>
<span class="co"># https://cran.r-project.org/</span>
<span class="co"># web/packages/pafr/vignettes/Introduction_to_pafr.html</span>
<span class="co">#</span>
<span class="co"># plot title is just string to add at top of plot</span>
<span class="co"># window_val = width of sliding window in bases</span>
<span class="co"># jump_val = number of bases sliding window moves forward for next window</span>

<span class="va">return_contig_cluster_plots</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">paf_df</span>,
                                        <span class="va">msa</span>,
                                        <span class="va">blast_df</span>,
                                        <span class="va">plot_title</span>,
                                        <span class="va">window_val</span> <span class="op">=</span> <span class="fl">1</span>,
                                        <span class="va">jump_val</span> <span class="op">=</span> <span class="fl">1</span>,
                                        <span class="va">xlim_min</span> <span class="op">=</span> <span class="cn">NA_real_</span>,
                                        <span class="va">xlim_max</span> <span class="op">=</span> <span class="cn">NA_real_</span>,
                                        <span class="va">geom_repel_xlim_max</span> <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Add start and end query locations on target</span>
  <span class="co"># Need to flip if negative strand</span>

  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va">PopGenome</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="http://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span>

  <span class="va">genecols_1</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span>
      <span class="st">"IS"</span> <span class="op">=</span> <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/viridis_pal.html" class="external-link">viridis_pal</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span><span class="op">)</span><span class="op">(</span><span class="fl">6</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
      <span class="st">"AMR"</span> <span class="op">=</span> <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/viridis_pal.html" class="external-link">viridis_pal</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span><span class="op">)</span><span class="op">(</span><span class="fl">6</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>,
      <span class="st">"Plasmid\nreplicon"</span> <span class="op">=</span> <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/viridis_pal.html" class="external-link">viridis_pal</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span><span class="op">)</span><span class="op">(</span><span class="fl">6</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>
    <span class="op">)</span>

  <span class="va">genecols_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span>
    <span class="st">"IS"</span> <span class="op">=</span> <span class="st">"blue"</span>,
    <span class="st">"AMR"</span> <span class="op">=</span> <span class="st">"red"</span>,
    <span class="st">"Plasmid\nreplicon"</span> <span class="op">=</span> <span class="st">"green"</span>
  <span class="op">)</span>

  <span class="va">paf_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
      qstart_coord <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span>
        <span class="va">strand</span> <span class="op">==</span> <span class="st">"+"</span>,
        <span class="va">tstart</span> <span class="op">-</span> <span class="va">qstart</span>,
        <span class="va">tstart</span> <span class="op">-</span> <span class="op">(</span><span class="va">qlen</span> <span class="op">-</span> <span class="va">qend</span><span class="op">)</span>
      <span class="op">)</span>,
      qend_coord <span class="op">=</span> <span class="va">qstart_coord</span> <span class="op">+</span> <span class="va">qlen</span>,
      qcov_start_coord <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span>
        <span class="va">strand</span> <span class="op">==</span> <span class="st">"+"</span>,
        <span class="va">qstart_coord</span> <span class="op">+</span> <span class="va">qstart</span>,
        <span class="va">qstart_coord</span> <span class="op">+</span>
          <span class="op">(</span><span class="va">qlen</span> <span class="op">-</span> <span class="va">qend</span><span class="op">)</span>
      <span class="op">)</span>,
      qcov_end_coord <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span>
        <span class="va">strand</span> <span class="op">==</span> <span class="st">"+"</span>,
        <span class="va">qstart_coord</span> <span class="op">+</span> <span class="va">qend</span>,
        <span class="va">qstart_coord</span> <span class="op">+</span> <span class="op">(</span><span class="va">qlen</span> <span class="op">-</span> <span class="va">qstart</span><span class="op">)</span>
      <span class="op">)</span>
    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">qname</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">qlen</span>, <span class="va">qname</span>, <span class="va">alen</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
      map_id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span>,
      qname_map <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">qname</span>, <span class="st">"_"</span>, <span class="va">map_id</span><span class="op">)</span>,
      map_type <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">alen</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">alen</span><span class="op">)</span>,
        <span class="st">"Primary"</span>,
        <span class="st">"Secondary"</span>
      <span class="op">)</span>
    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>axis_scale_pos <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span>
      <span class="va">map_type</span> <span class="op">==</span> <span class="st">"Primary"</span>, <span class="fl">0.8</span>, <span class="fl">0.6</span>
    <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">qlen</span><span class="op">)</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">qname</span><span class="op">)</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">alen</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>axis_scale_pos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">axis_scale_pos</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">df</span>
  <span class="co"># fudgey axis positions - continuous scale that</span>
  <span class="co"># will later be changed to 'discrete'</span>
  <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>axis_scale_pos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">-</span> <span class="va">axis_scale_pos</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">qname</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>axis_location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">axis_scale_pos</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">df</span>
  <span class="co"># Add in reference</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>
      qname <span class="op">=</span> <span class="st">"Cluster Reference"</span>,
      qstart_coord <span class="op">=</span> <span class="fl">0</span>,
      qend_coord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">tlen</span><span class="op">)</span>,
      qcov_start_coord <span class="op">=</span> <span class="fl">0</span>,
      qcov_end_coord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">tlen</span><span class="op">)</span>,
      axis_scale_pos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">axis_scale_pos</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>,
      axis_location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">axis_scale_pos</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>,
      map_type <span class="op">=</span> <span class="st">"Primary"</span>,
      reference <span class="op">=</span> <span class="st">"Reference"</span>
    <span class="op">)</span>,
    <span class="va">df</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
      reference <span class="op">=</span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span>
          <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">reference</span><span class="op">)</span> <span class="op">~</span> <span class="va">strand</span>,
          <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">reference</span>
        <span class="op">)</span>
    <span class="op">)</span> <span class="op">-&gt;</span> <span class="va">df</span>

  <span class="va">blast_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
      qname <span class="op">=</span> <span class="st">"Cluster Reference"</span>,
      reference <span class="op">=</span> <span class="cn">NA</span>
    <span class="op">)</span> <span class="op">-&gt;</span> <span class="va">blast_df</span>

<span class="co"># couple of nudges of position for plot elements</span>
  <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span>
        <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"axis"</span><span class="op">)</span>,
        <span class="op">~</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">qname</span> <span class="op">==</span> <span class="st">"Cluster Reference"</span>,
          <span class="va">.x</span> <span class="op">+</span> <span class="fl">1</span>, <span class="va">.x</span>
        <span class="op">)</span>
      <span class="op">)</span>
    <span class="op">)</span> <span class="op">-&gt;</span> <span class="va">df</span>

  <span class="va">blast_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
      nudge <span class="op">=</span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"amr"</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,
      type <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span>
        <span class="va">type</span> <span class="op">==</span> <span class="st">"is"</span> <span class="op">~</span> <span class="st">"IS"</span>,
        <span class="va">type</span> <span class="op">==</span> <span class="st">"amr"</span> <span class="op">~</span> <span class="st">"AMR"</span>,
        <span class="va">type</span> <span class="op">==</span> <span class="st">"plasmid"</span> <span class="op">~</span> <span class="st">"Plasmid\nreplicon"</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">-&gt;</span>
  <span class="va">blast_df</span>


<span class="co"># set xlimit vals</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">xlim_min</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">xlim_min</span> <span class="op">&lt;-</span> <span class="fl">0</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">tlen</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fl">10</span>
    <span class="op">}</span>

  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">xlim_max</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">xlim_max</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">tlen</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">tlen</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fl">10</span>
  <span class="op">}</span>
  
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">geom_repel_xlim_max</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">geom_repel_xlim_max</span> <span class="op">&lt;-</span> <span class="va">xlim_max</span>
  <span class="op">}</span>
  
  <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
      reference <span class="op">=</span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">strand</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"+"</span>, <span class="st">"-"</span><span class="op">)</span>,
          <span class="st">"Covered on\nmapped strand"</span>, <span class="va">strand</span>
        <span class="op">)</span>
    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>
    xmin <span class="op">=</span> <span class="va">qstart_coord</span>,
    xmax <span class="op">=</span> <span class="va">qend_coord</span>,
    y <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">qname_map</span><span class="op">)</span>,
    ymin <span class="op">=</span> <span class="va">axis_scale_pos</span> <span class="op">-</span> <span class="fl">0.2</span>,
    ymax <span class="op">=</span> <span class="va">axis_scale_pos</span> <span class="op">+</span> <span class="fl">0.2</span>,
    fill <span class="op">=</span> <span class="va">reference</span>,
    linetype <span class="op">=</span> <span class="va">map_type</span>
  <span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>
      xmin <span class="op">=</span> <span class="va">qcov_start_coord</span>,
      xmax <span class="op">=</span> <span class="va">qcov_end_coord</span>
    <span class="op">)</span>,
    color <span class="op">=</span> <span class="cn">NA</span>,
    size <span class="op">=</span> <span class="fl">1</span>,
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span>
      color <span class="op">=</span> <span class="st">"black"</span>,
      fill <span class="op">=</span> <span class="st">"white"</span>,
      size <span class="op">=</span> <span class="fl">0.5</span>,
      alpha <span class="op">=</span> <span class="fl">0</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>
      labels <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">qname</span>,
      breaks <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">axis_location</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span> <span class="op">/</span> <span class="fl">1e3</span>, <span class="st">"Kb"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>
      xlim <span class="op">=</span>
        <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span>
          <span class="va">xlim_min</span>, <span class="va">xlim_max</span>
        <span class="op">)</span>,
      ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span>
        <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">axis_scale_pos</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.25</span>,
        <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">axis_scale_pos</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span>
      <span class="op">)</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>
      values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span>
        <span class="st">"Reference"</span> <span class="op">=</span> <span class="st">"grey"</span>,
        <span class="st">"Covered on\nmapped strand"</span> <span class="op">=</span> <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/viridis_pal.html" class="external-link">viridis_pal</a></span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>
      <span class="op">)</span>,
      na.value <span class="op">=</span> <span class="st">"grey"</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linetype_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span>
      <span class="st">"Primary"</span> <span class="op">=</span> <span class="st">"solid"</span>,
      <span class="st">"Secondary"</span> <span class="op">=</span> <span class="st">"dashed"</span>
    <span class="op">)</span>, <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>
      x <span class="op">=</span> <span class="st">"Position on cluster reference assembly"</span>,
      y <span class="op">=</span> <span class="st">"Contig ID"</span>,
      fill <span class="op">=</span> <span class="st">"Mapped\nRegions"</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/ggnewscale/man/new_scale.html" class="external-link">new_scale_fill</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>
      xmin <span class="op">=</span> <span class="va">qstart</span>, xmax <span class="op">=</span> <span class="va">qend</span>,
      ymin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">axis_scale_pos</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.2</span>,
      ymax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">axis_scale_pos</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.2</span>,
      y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">axis_scale_pos</span><span class="op">)</span>,
      fill <span class="op">=</span> <span class="va">type</span>,
      linetype <span class="op">=</span> <span class="st">"solid"</span>
    <span class="op">)</span>,
    alpha <span class="op">=</span> <span class="fl">0.6</span>,
    data <span class="op">=</span> <span class="va">blast_df</span>,
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html" class="external-link">geom_text_repel</a></span><span class="op">(</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>
        y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">axis_scale_pos</span><span class="op">)</span>,
        x <span class="op">=</span> <span class="va">qstart</span> <span class="op">+</span> <span class="op">(</span><span class="va">qend</span> <span class="op">-</span> <span class="va">qstart</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>,
        xmin <span class="op">=</span> <span class="va">qstart</span>, xmax <span class="op">=</span> <span class="va">qend</span>,
        ymin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">axis_scale_pos</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.2</span>,
        ymax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">axis_scale_pos</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.2</span>,
        label <span class="op">=</span> <span class="va">gene</span>,
        fill <span class="op">=</span> <span class="va">type</span>,
        linetype <span class="op">=</span> <span class="st">"solid"</span>,
        label_padding <span class="op">=</span> <span class="fl">0.35</span>,
        color <span class="op">=</span> <span class="va">type</span>
      <span class="op">)</span>,
      nudge_y <span class="op">=</span> <span class="va">blast_df</span><span class="op">$</span><span class="va">nudge</span>,
      direction <span class="op">=</span> <span class="st">"both"</span>,
      xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="va">xlim_min</span>, <span class="va">geom_repel_xlim_max</span><span class="op">)</span>,
      data <span class="op">=</span> <span class="va">blast_df</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>
      values <span class="op">=</span> <span class="va">genecols_2</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>
      values <span class="op">=</span> <span class="va">genecols_2</span>,
      guide <span class="op">=</span> <span class="st">"none"</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>
      fill <span class="op">=</span> <span class="st">"Gene\nType"</span>,
      color <span class="op">=</span> <span class="st">"Gene\nType"</span>
    <span class="op">)</span> <span class="op">-&gt;</span> <span class="va">p</span>

  <span class="co"># now nucleotide diversity</span>
  <span class="fu"><a href="https://rdrr.io/pkg/PopGenome/man/GENOME-class.html" class="external-link">sliding.window.transform</a></span><span class="op">(</span><span class="va">msa</span>,
    width <span class="op">=</span> <span class="va">window_val</span>,
    jump <span class="op">=</span> <span class="va">jump_val</span>,
    type <span class="op">=</span> <span class="fl">2</span>
  <span class="op">)</span> <span class="op">-&gt;</span> <span class="va">shv2</span>
  <span class="fu"><a href="https://rdrr.io/pkg/PopGenome/man/GENOME-class.html" class="external-link">diversity.stats</a></span><span class="op">(</span><span class="va">shv2</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">msa2</span>
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">msa2</span><span class="op">@</span><span class="va">nuc.diversity.within</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">nuc_div</span>
  <span class="va">nuc_div</span><span class="op">$</span><span class="va">window</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">nuc_div</span><span class="op">)</span>

  <span class="co"># get window location for plotting</span>
  <span class="va">nuc_div</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
      window_left <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">window</span>, <span class="st">"^[0-9]+(?= )"</span><span class="op">)</span><span class="op">)</span>,
      window_right <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">window</span>, <span class="st">"(?&lt;=- )[0-9]+(?= )"</span><span class="op">)</span><span class="op">)</span>,
      window_mid <span class="op">=</span> <span class="va">window_left</span> <span class="op">+</span>
        <span class="op">(</span><span class="va">window_right</span> <span class="op">-</span> <span class="va">window_left</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>
    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>diversity <span class="op">=</span> <span class="va">pop.1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>diversity <span class="op">=</span> <span class="va">diversity</span> <span class="op">/</span> <span class="va">window_val</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">nuc_div</span>

  <span class="co"># plot nuc diversity</span>
  <span class="va">nuc_div</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">window_mid</span>, <span class="va">diversity</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>
      xlim <span class="op">=</span>
        <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span>
          <span class="va">xlim_min</span>, <span class="va">xlim_max</span>
        <span class="op">)</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>
      x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      y <span class="op">=</span> <span class="st">"Cluster\nnucleotide diversity"</span>,
      title <span class="op">=</span> <span class="op">{</span><span class="op">{</span> <span class="va">plot_title</span> <span class="op">}</span><span class="op">}</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">p2</span>
  <span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">p2</span> <span class="op">+</span> <span class="va">p</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">1</span>, heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">plot_out</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">listout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">btESBL_contigclusters_msa_paf_files</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">btESBL_contigclusters_msa_paf_files</span><span class="op">)</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">"CTX_M_15.10"</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu">return_contig_cluster_plots</span><span class="op">(</span>
    <span class="va">btESBL_contigclusters_msa_paf_files</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,
    <span class="va">btESBL_contigclusters_msa_alignments</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,
    <span class="va">blast_processed</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">clstr_name</span> <span class="op">==</span> 
                   <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">btESBL_contigclusters_msa_paf_files</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">btESBL_contigclusters_msa_paf_files</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, 
    xlim_min <span class="op">=</span> <span class="op">-</span><span class="fl">10000</span>, 
    xlim_max <span class="op">=</span> <span class="fl">50000</span>,
    geom_repel_xlim_max <span class="op">=</span> <span class="fl">100000</span>
<span class="op">)</span>  <span class="op">-&gt;</span> <span class="va">listout</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> 
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
  
  <span class="fu">return_contig_cluster_plots</span><span class="op">(</span>
    <span class="va">btESBL_contigclusters_msa_paf_files</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,
    <span class="va">btESBL_contigclusters_msa_alignments</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,
   <span class="va">blast_processed</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">clstr_name</span> <span class="op">==</span> 
    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">btESBL_contigclusters_msa_paf_files</span><span class="op">)</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">btESBL_contigclusters_msa_paf_files</span><span class="op">)</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>
  <span class="op">)</span> <span class="op">-&gt;</span>
  <span class="va">listout</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>
  <span class="op">}</span>
<span class="op">}</span>
<span class="co">#&gt; Warning: Ignoring unknown aesthetics: y</span>
<span class="co">#&gt; Warning: Ignoring unknown aesthetics: xmin, xmax, ymin, ymax, fill, linetype,</span>
<span class="co">#&gt; label_padding</span>
<span class="co">#&gt; |            :            |            :            | 100 %</span>
<span class="co">#&gt; |=|            :            |            :            | 100 %</span>
<span class="co">#&gt; |=</span>
<span class="co">#&gt; Warning: Ignoring unknown aesthetics: y</span>
<span class="co">#&gt; Ignoring unknown aesthetics: xmin, xmax, ymin, ymax, fill, linetype, label_padding</span>
<span class="co">#&gt; |            :            |            :            | 100 %</span>
<span class="co">#&gt; |===================================|            :            |            :            | 100 %</span>
<span class="co">#&gt; |===================================</span>
<span class="co">#&gt; Warning: Ignoring unknown aesthetics: y</span>
<span class="co">#&gt; Ignoring unknown aesthetics: xmin, xmax, ymin, ymax, fill, linetype, label_padding</span>
<span class="co">#&gt; |            :            |            :            | 100 %</span>
<span class="co">#&gt; |==================================|            :            |            :            | 100 %</span>
<span class="co">#&gt; |==================================</span>
<span class="co">#&gt; Warning: Ignoring unknown aesthetics: y</span>
<span class="co">#&gt; Ignoring unknown aesthetics: xmin, xmax, ymin, ymax, fill, linetype, label_padding</span>
<span class="co">#&gt; |            :            |            :            | 100 %</span>
<span class="co">#&gt; |===================================================|            :            |            :            | 100 %</span>
<span class="co">#&gt; |===================================================</span>
<span class="co">#&gt; Warning: Ignoring unknown aesthetics: y</span>
<span class="co">#&gt; Ignoring unknown aesthetics: xmin, xmax, ymin, ymax, fill, linetype, label_padding</span>
<span class="co">#&gt; |            :            |            :            | 100 %</span>
<span class="co">#&gt; |================================================|            :            |            :            | 100 %</span>
<span class="co">#&gt; |================================================</span>
<span class="co">#&gt; Warning: Ignoring unknown aesthetics: y</span>
<span class="co">#&gt; Ignoring unknown aesthetics: xmin, xmax, ymin, ymax, fill, linetype, label_padding</span>
<span class="co">#&gt; |            :            |            :            | 100 %</span>
<span class="co">#&gt; |====================================================|            :            |            :            | 100 %</span>
<span class="co">#&gt; |====================================================</span>
<span class="co">#&gt; Warning: Ignoring unknown aesthetics: y</span>
<span class="co">#&gt; Ignoring unknown aesthetics: xmin, xmax, ymin, ymax, fill, linetype, label_padding</span>
<span class="co">#&gt; |            :            |            :            | 100 %</span>
<span class="co">#&gt; |===================================================|            :            |            :            | 100 %</span>
<span class="co">#&gt; |===================================================</span>
<span class="co">#&gt; Warning: Ignoring unknown aesthetics: y</span>
<span class="co">#&gt; Ignoring unknown aesthetics: xmin, xmax, ymin, ymax, fill, linetype, label_padding</span>
<span class="co">#&gt; |            :            |            :            | 100 %</span>
<span class="co">#&gt; |=========|            :            |            :            | 100 %</span>
<span class="co">#&gt; |=========</span>
<span class="co">#&gt; Warning: Ignoring unknown aesthetics: y</span>
<span class="co">#&gt; Ignoring unknown aesthetics: xmin, xmax, ymin, ymax, fill, linetype, label_padding</span>
<span class="co">#&gt; |            :            |            :            | 100 %</span>
<span class="co">#&gt; |===========|            :            |            :            | 100 %</span>
<span class="co">#&gt; |===========</span>
<span class="co">#&gt; Warning: Ignoring unknown aesthetics: y</span>
<span class="co">#&gt; Ignoring unknown aesthetics: xmin, xmax, ymin, ymax, fill, linetype, label_padding</span>
<span class="co">#&gt; |            :            |            :            | 100 %</span>
<span class="co">#&gt; |====================================================|            :            |            :            | 100 %</span>
<span class="co">#&gt; |====================================================</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_int</a></span><span class="op">(</span><span class="va">btESBL_contigclusters_msa_paf_files</span>, <span class="va">nrow</span><span class="op">)</span>, 
                decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">listout</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">)</span>
  
    <span class="kw">if</span> <span class="op">(</span><span class="va">write_figs</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>
        <span class="st">"figures/long-modelling/SUP_FIG_contig_msa_"</span>,
        <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">btESBL_contigclusters_msa_paf_files</span><span class="op">)</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,
        <span class="st">".pdf"</span>
      <span class="op">)</span><span class="op">)</span>, <span class="va">listout</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,
      width <span class="op">=</span> <span class="fl">10</span>, height <span class="op">=</span> <span class="fl">10</span>
    <span class="op">)</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>
        <span class="st">"figures/long-modelling/SUP_FIG_contig_msa_"</span>,
        <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">btESBL_contigclusters_msa_paf_files</span><span class="op">)</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,
        <span class="st">".svg"</span>
      <span class="op">)</span><span class="op">)</span>, <span class="va">listout</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,
      width <span class="op">=</span> <span class="fl">10</span>, height <span class="op">=</span> <span class="fl">10</span>
    <span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p><img src="contig-clusters_files/figure-html/plot-contig-msas-1.png" width="1152"><img src="contig-clusters_files/figure-html/plot-contig-msas-2.png" width="1152"><img src="contig-clusters_files/figure-html/plot-contig-msas-3.png" width="1152"><img src="contig-clusters_files/figure-html/plot-contig-msas-4.png" width="1152"></p>
<pre><code><span class="co">#&gt; Warning: Removed 4 row(s) containing missing values (geom_path).</span>
<span class="co">#&gt; Removed 4 row(s) containing missing values (geom_path).</span>
<span class="co">#&gt; Removed 4 row(s) containing missing values (geom_path).</span></code></pre>
<p><img src="contig-clusters_files/figure-html/plot-contig-msas-5.png" width="1152"><img src="contig-clusters_files/figure-html/plot-contig-msas-6.png" width="1152"></p>
<pre><code><span class="co">#&gt; Warning: Removed 1 row(s) containing missing values (geom_path).</span>
<span class="co">#&gt; Warning: Removed 1 row(s) containing missing values (geom_path).</span>
<span class="co">#&gt; Removed 1 row(s) containing missing values (geom_path).</span></code></pre>
<p><img src="contig-clusters_files/figure-html/plot-contig-msas-7.png" width="1152"><img src="contig-clusters_files/figure-html/plot-contig-msas-8.png" width="1152"></p>
<pre><code><span class="co">#&gt; Warning: Removed 2 row(s) containing missing values (geom_path).</span>
<span class="co">#&gt; Warning: Removed 2 row(s) containing missing values (geom_path).</span>
<span class="co">#&gt; Removed 2 row(s) containing missing values (geom_path).</span></code></pre>
<p><img src="contig-clusters_files/figure-html/plot-contig-msas-9.png" width="1152"><img src="contig-clusters_files/figure-html/plot-contig-msas-10.png" width="1152"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Joseph Lewis.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
